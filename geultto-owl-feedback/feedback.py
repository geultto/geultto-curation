import streamlit as st
from openai import OpenAI

def get_system_message(feedback_style: str) -> str:
    system_messages = {
        "MILD": """
        ë‹¹ì‹ ì€ ë”°ëœ»í•˜ê³  ê¸ì •ì ì¸ ê¸€ì“°ê¸° ë©˜í† ì…ë‹ˆë‹¤. ì‘ì„±ìì˜ ë…¸ë ¥ê³¼ ì°½ì˜ì„±ì„ ì§„ì‹¬ìœ¼ë¡œ ì¹­ì°¬í•˜ê³ , ê·¸ë“¤ì˜ ì ì¬ë ¥ì„ ì´ëŒì–´ë‚´ëŠ” ê²ƒì´ ì£¼ëœ ì—­í• ì…ë‹ˆë‹¤.
        
        ê¸€ì„ ì½ê³  ë‹¤ìŒê³¼ ê°™ì€ ë°©ì‹ìœ¼ë¡œ í”¼ë“œë°±ì„ ì œê³µí•´ì£¼ì„¸ìš”:
        - ê¸€ì˜ ë…íŠ¹í•˜ê³  ì¸ìƒì ì¸ ë¶€ë¶„ì„ êµ¬ì²´ì ìœ¼ë¡œ ì–¸ê¸‰í•˜ë©° ì§„ì‹¬ ì–´ë¦° ì¹­ì°¬
        - ì‘ì„±ìì˜ ë…¸ë ¥ê³¼ ì„±ì¥ ê°€ëŠ¥ì„±ì„ ì ê·¹ì ìœ¼ë¡œ ì¸ì •
        - ì‘ì„±ìê°€ ìì‹ ê°ì„ ê°€ì§ˆ ìˆ˜ ìˆë„ë¡ ë”°ëœ»í•œ ê²©ë ¤ì˜ ë§ í¬í•¨
        - ê°œì„ ì ì€ ìµœì†Œí™”í•˜ê³  ê¸ì •ì ì¸ ì œì•ˆ í˜•íƒœë¡œ ë¶€ë“œëŸ½ê²Œ í‘œí˜„
        - ì‘ì„±ìì˜ ë‹¤ìŒ ê¸€ì´ ê¸°ëŒ€ëœë‹¤ëŠ” ì‘ì›ì˜ ë©”ì‹œì§€ë¡œ ë§ˆë¬´ë¦¬
        - 3-4ì¤„ì˜ ê°„ë‹¨í•˜ê³  ë”°ëœ»í•œ í†¤ì˜ í”¼ë“œë°±
        ì„œë¬¸ì´ë‚˜ ë„˜ë²„ë§ ì—†ì´, ë°”ë¡œ ì§„ì‹¬ ì–´ë¦° ì¹­ì°¬ê³¼ ê²©ë ¤ ìœ„ì£¼ì˜ í”¼ë“œë°±ì„ ì‘ì„±í•´ì£¼ì„¸ìš”.
        """,
        
        "HOT": """
        ë‹¹ì‹ ì€ ë”°ëœ»í•˜ê³  ê±´ì„¤ì ì¸ ê¸€ì“°ê¸° ë©˜í† ì…ë‹ˆë‹¤. ì‘ì„±ìì˜ ë…¸ë ¥ì„ ì¸ì •í•˜ê³  ê²©ë ¤í•˜ë©´ì„œë„, ë” ë‚˜ì€ ë°©í–¥ìœ¼ë¡œ ë°œì „í•  ìˆ˜ ìˆë„ë¡ ë„ì™€ì£¼ëŠ” ì—­í• ì„ í•©ë‹ˆë‹¤.

        ê¸€ì„ ì½ê³  ë‹¤ìŒê³¼ ê°™ì€ ë°©ì‹ìœ¼ë¡œ í”¼ë“œë°±ì„ ì œê³µí•´ì£¼ì„¸ìš”:
        - ì‘ì„±ìì˜ ê´€ì ê³¼ ì˜ë„ë¥¼ ì´í•´í•˜ê³  ê³µê°í•˜ëŠ” ë”°ëœ»í•œ í”¼ë“œë°±
        - ê°œì„ ì ì„ ì œì•ˆí•  ë•ŒëŠ” ë¶€ë“œëŸ½ê³  ê±´ì„¤ì ì¸ í‘œí˜„ ì‚¬ìš©
        - ê¸€ì˜ ì¥ì ì„ ë¨¼ì € ì–¸ê¸‰í•œ í›„ ë³´ì™„í•  ì  ì œì‹œ
        - 3-4ì¤„ì˜ ê°„ë‹¨ëª…ë£Œí•œ í”¼ë“œë°±
        - ì‘ì„±ìë¥¼ ì¡´ì¤‘í•˜ëŠ” ê²©ë ¤ì˜ ë§ë¡œ ë§ˆë¬´ë¦¬

        ì„œë¬¸ì´ë‚˜ ë„˜ë²„ë§ ì—†ì´, ë°”ë¡œ í”¼ë“œë°± ë‚´ìš©ë§Œ ë”°ëœ»í•œ ì–´ì¡°ë¡œ ì‘ì„±í•´ì£¼ì„¸ìš”.
        """,

        "FIRE": """
        ë‹¹ì‹ ì€ ë‚ ì¹´ë¡œìš´ í†µì°°ë ¥ì„ ì§€ë‹Œ ê¸€ì“°ê¸° ë©˜í† ì…ë‹ˆë‹¤. ê±´ì„¤ì ì´ë©´ì„œë„ ëª…í™•í•œ ê°œì„ ì ì„ ì œì‹œí•©ë‹ˆë‹¤.

        ë‹¤ìŒ ê¸°ì¤€ìœ¼ë¡œ 3-4ì¤„ì˜ ê°„ë‹¨ëª…ë£Œí•œ í”¼ë“œë°±ì„ ì œê³µí•´ì£¼ì„¸ìš”:
        - ê¸€ì˜ ì£¼ìš” ë¬¸ì œì ì„ ëª…í™•í•˜ê²Œ ì§€ì 
        - êµ¬ì²´ì ì¸ ê°œì„  ë°©í–¥ ì œì‹œ
        - ê¸€ì˜ ì ì¬ë ¥ì„ ëŒì–´ì˜¬ë¦´ ìˆ˜ ìˆëŠ” ë„ì „ ê³¼ì œ ì œì•ˆ
        - ê°ê´€ì ì´ê³  ì§ì„¤ì ì¸ ì–´ì¡° ìœ ì§€
        ì„œë¬¸ì´ë‚˜ ë„˜ë²„ë§ ì—†ì´, í”¼ë“œë°± ë‚´ìš©ë§Œ ê°„ë‹¨íˆ ì‘ì„±í•´ì£¼ì„¸ìš”. 
        """,
        
        "DIABLO": """
        ë‹¹ì‹ ì€ ì§ì„¤ì ì´ê³  ëª…í™•í•œ ê¸€ì“°ê¸° ë©˜í† ì…ë‹ˆë‹¤. ë¶ˆí•„ìš”í•œ ë¯¸í™” ì—†ì´ í•µì‹¬ì ì¸ ê°œì„ ì ì„ ì§€ì í•˜ë˜, ê±´ì„¤ì ì¸ ë°©í–¥ì„ ì œì‹œí•©ë‹ˆë‹¤.

        ê¸€ì„ ì½ê³  ë‹¤ìŒê³¼ ê°™ì€ ë°©ì‹ìœ¼ë¡œ í”¼ë“œë°±ì„ ì œê³µí•´ì£¼ì„¸ìš”:
        - í•µì‹¬ì ì¸ ë¬¸ì œì ì„ ì§ì ‘ì ìœ¼ë¡œ ì§€ì 
        - êµ¬ì²´ì ì¸ ê°œì„  ë°©í–¥ ì œì‹œ
        - ë¶ˆí•„ìš”í•œ ì¹­ì°¬ì€ ë°°ì œí•˜ê³  ì‹¤ì§ˆì ì¸ ì¡°ì–¸ì— ì§‘ì¤‘
        - 3-4ì¤„ì˜ ê°„ë‹¨ëª…ë£Œí•œ í”¼ë“œë°±
        - ì‹¤í–‰ ê°€ëŠ¥í•œ êµ¬ì²´ì  ê°œì„  ì œì•ˆìœ¼ë¡œ ë§ˆë¬´ë¦¬
        ì„œë¬¸ì´ë‚˜ ë„˜ë²„ë§ ì—†ì´, ë°”ë¡œ í”¼ë“œë°± ë‚´ìš©ë§Œ ì§ì„¤ì ì¸ ì–´ì¡°ë¡œ ì‘ì„±í•´ì£¼ì„¸ìš”.
        """
    }
    return system_messages[feedback_style]

def get_feedback_message(blog: str) -> str:
    return f"""
    ìš°ì„ , Blogë¥¼ ì½ìœ¼ì„¸ìš”. <blog>{blog}</blog> 
    ë‹¤ìŒ, í‰ê°€ ê¸°ì¤€ <guideline>ì„ ì°¸ê³ í•˜ì—¬ ì œì¶œëœ ê¸€ì— ëŒ€í•œ í”¼ë“œë°±ì„ ìƒê°í•˜ì„¸ìš”.

    <guideline>
    1. êµ¬ì¡°ì  ì™„ì„±ë„
    - ì„œë¡ /ë³¸ë¡ /ê²°ë¡ ì˜ ëª…í™•í•œ êµ¬ì¡°
    - ì„œë¡ : ê¸€ì˜ ìš”ì•½, ë…ì íƒ€ê²ŸíŒ…, ê¸°ëŒ€íš¨ê³¼, ì‘ì„± ë™ê¸° í¬í•¨
    - ë³¸ë¡ : ë¬¸ì œ ìƒí™© â†’ ì›ì¸ ë¶„ì„ â†’ í•´ê²° ê³¼ì •ì˜ ìì—°ìŠ¤ëŸ¬ìš´ íë¦„
    - ê²°ë¡ : ë‚´ìš© ìš”ì•½, íš¨ê³¼, í•œê³„ì  ì œì‹œ

    2. ë‚´ìš©ì˜ ë…ì°½ì„±ê³¼ ì „ë¬¸ì„±
    - ê°œì¸ì  ê²½í—˜ê³¼ ê´€ì ì˜ ë°˜ì˜ë„
    - ì£¼ì œì— ëŒ€í•œ ë…ìì  í•´ì„ê³¼ í†µì°°
    - ë°°ê²½ì§€ì‹ ì„¤ëª…ì˜ ì ì ˆì„±
    - ë‹¨ìˆœ ì •ë³´ ë‚˜ì—´ì´ ì•„ë‹Œ ê°œì¸ì˜ ê´€ì  ì œì‹œ
    - ë…ìì˜ ì´í•´ë¥¼ ë•ëŠ” ì˜ˆì‹œ/ë¹„ìœ  í™œìš©

    3. ê°€ë…ì„±ê³¼ í‘œí˜„ë ¥
    - ë¬¸ë‹¨ êµ¬ë¶„ê³¼ ì—¬ë°±ì˜ ì ì ˆì„±
    - í°íŠ¸, ìê°„, ê°•ì¡°ì˜ ì¼ê´€ì„±
    - ì´ë¯¸ì§€ì™€ ì½”ë“œì˜ ì ì ˆí•œ ë°°ì¹˜
    - ì˜¤íƒ€ ë° ë¬¸ë²•ì  ì˜¤ë¥˜
    - ì ì ˆí•œ ê¸¸ì´ì™€ ë¬¸ì¥ë ¥

    4. ë…ì ì¹œí™”ì„±
    - ì²« ë¬¸ì¥ì˜ í¥ë¯¸ ìœ ë°œë„
    - ì „ë¬¸ìš©ì–´ì— ëŒ€í•œ ì ì ˆí•œ ì„¤ëª…
    - ê¸€ì˜ íë¦„ê³¼ ì—°ê²°ì„±
    - ì ì ˆí•œ ìœ ë¨¸ì™€ ì´ëª¨ì§€ í™œìš©
    - ë…ìì™€ì˜ ì†Œí†µì„ ê³ ë ¤í•œ ë¬¸ì²´
    </guideline>
    """

def get_openai_feedback(api_key: str, base_url: str, model: str, blog_text: str, feedback_style: str) -> str:
    # OpenAI í´ë¼ì´ì–¸íŠ¸ ì„¤ì •
    client_params = {"api_key": api_key}
    if base_url:  # base_urlì´ ì…ë ¥ëœ ê²½ìš°ì—ë§Œ ì¶”ê°€
        client_params["base_url"] = base_url
    
    client = OpenAI(**client_params)
    
    try:
        system_message = get_system_message(feedback_style)
        user_message = get_feedback_message(blog_text)
        
        completion = client.chat.completions.create(
            model=model,
            messages=[
                {"role": "system", "content": system_message},
                {"role": "user", "content": user_message}
            ],
            max_tokens=1024,
            temperature=0.2,
            top_p=0.9
        )
        
        return completion.choices[0].message.content
    except Exception as e:
        return f"Error generating feedback: {str(e)}"

def main():
    st.set_page_config(page_title="ê¸€ë˜ í”¼ë“œë°± ìƒì„±ê¸°", page_icon="ğŸ“", layout="wide")
    
    st.title("ğŸ“ ê¸€ë˜ í”¼ë“œë°± ìƒì„±ê¸°")
    st.markdown("---")

    # Sidebar for configuration
    with st.sidebar:
        st.header("âš™ï¸ ì„¤ì •")
        api_key = st.text_input("API Key", type="password")
        base_url = st.text_input(
            "Base URL (ì„ íƒì‚¬í•­)",
            placeholder="ì˜ˆ: https://api.openai.com/v1 (OpenAI ì‚¬ìš©ì‹œ ë¹„ì›Œë‘ì„¸ìš”)",
            help="OpenAI í˜¸í™˜ APIë¥¼ ì‚¬ìš©í•  ê²½ìš° Base URLì„ ì…ë ¥í•˜ì„¸ìš”. OpenAI ì‚¬ìš©ì‹œì—ëŠ” ë¹„ì›Œë‘ì„¸ìš”."
        )
        model = st.text_input(
            "ëª¨ë¸ëª…",
            placeholder="ì˜ˆ: gpt-4, gpt-3.5-turbo, anthropic.claude-3-sonnet-20240229-v1:0",
            help="ì‚¬ìš©í•˜ê³ ì í•˜ëŠ” ëª¨ë¸ëª…ì„ ì…ë ¥í•˜ì„¸ìš”"
        )
        
        # í”¼ë“œë°± ìŠ¤íƒ€ì¼ ì„ íƒ ì˜µì…˜ ë³€ê²½
        style_mapping = {
            "ğŸŒ± ìˆœí•œë§›": "MILD",
            "ğŸ§„ ë³´í†µë§›": "HOT",
            "ğŸŒ¶ï¸ ë§¤ìš´ë§›": "FIRE",
            "â˜ ï¸ ì§€ì˜¥ë§›": "DIABLO"
        }
        
        selected_style = st.selectbox(
            "í”¼ë“œë°± ìŠ¤íƒ€ì¼",
            list(style_mapping.keys()),
            index=0
        )
        feedback_style = style_mapping[selected_style]

    # Main content area
    st.header("ğŸ“„ ë¸”ë¡œê·¸ ê¸€ ì…ë ¥")
    blog_text = st.text_area("í”¼ë“œë°±ì„ ë°›ê³  ì‹¶ì€ ê¸€ì„ ì…ë ¥í•˜ì„¸ìš”", height=300)

    if st.button("í”¼ë“œë°± ìƒì„±", type="primary"):
        if not api_key:
            st.error("API Keyë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”!")
            return
        
        if not model:
            st.error("ëª¨ë¸ëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!")
            return
        
        if not blog_text:
            st.error("ë¸”ë¡œê·¸ ê¸€ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!")
            return

        with st.spinner("í”¼ë“œë°±ì„ ìƒì„±í•˜ê³  ìˆìŠµë‹ˆë‹¤..."):
            feedback = get_openai_feedback(api_key, base_url, model, blog_text, feedback_style)
            
            st.header("ğŸ’¬ ìƒì„±ëœ í”¼ë“œë°±")
            st.markdown(feedback)

if __name__ == "__main__":
    main()
